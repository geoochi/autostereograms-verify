<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test - Display PNG from API</title>
  </head>

  <body onload="loadImage()" style="margin: 0; padding: 20px">
    <div style="display: flex; justify-content: center; flex-direction: column; height: 100vh; align-items: center">
      <h1>Test: PNG Image<span id="text"></span></h1>
      <button onclick="loadImage()" style="margin-bottom: 20px; padding: 10px 20px; font-size: 16px">Refresh Image</button>
      <div id="loading" style="display: none; margin-bottom: 20px">Loading...</div>
      <div id="error" style="display: none; color: red; margin-bottom: 20px"></div>
      <img id="image" style="max-width: 100%; max-height: 80vh; border: 1px solid #ccc" />
    </div>

    <script>
      async function loadImage() {
        const loadingEl = document.getElementById('loading')
        const errorEl = document.getElementById('error')
        const textEl = document.getElementById('text')
        const imageEl = document.getElementById('image')

        // 显示加载状态
        loadingEl.style.display = 'block'
        errorEl.style.display = 'none'
        imageEl.style.display = 'none'

        try {
          // 从 API 获取数据
          const response = await fetch('/api/test')
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`)
          }
          const data = await response.json()

          textEl.textContent = data.text
          imageEl.src = data.dataURL
          imageEl.style.display = 'block'
          loadingEl.style.display = 'none'
        } catch (error) {
          console.error('Error loading image:', error)
          errorEl.textContent = `Error: ${error.message}`
          errorEl.style.display = 'block'
          loadingEl.style.display = 'none'
        }
      }
    </script>
  </body>
</html>
